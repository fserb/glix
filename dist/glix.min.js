(function(){var a=function(b){var c=document.getElementById(b),d=c.getContext("experimental-webgl");d.canvas=c;for(var e in a.module)a.module[e](d);return d};a.module={base:function(a){a._state={},a._objects={}}},"glix"in window||(window.glix=a)})(),glix.module.objects=function(a){a.assign=function(b){var c=a._objects[b];if(!c)throw"'"+b+"' used before being initialized.";c.bind();return c.assign()},a.remove=function(b){delete a._objects[b];return a}},glix.module.shader=function(a){var b=function(b,c){var d;if(c[0]=="#"){var e=document.getElementById(c.slice(1));d=e.textContent}else{var e=$.ajax({url:c,async:!1});d=e.responseText}d="#ifdef GL_ES\nprecision highp float;\n#endif\n"+d;var f=a.createShader(b);a.shaderSource(f,d),a.compileShader(f);if(!a.getShaderParameter(f,a.COMPILE_STATUS))throw"gl.compileShader("+c+"): "+a.getShaderInfoLog(f);return f},c={};c[a.INT]=function(b){return function(c){a.uniform1i(b,c)}},c[a.FLOAT]=function(b){return function(c){a.uniform1f(b,c)}},c[a.INT_VEC2]=function(b){return function(c){a.uniform2iv(b,c)}},c[a.INT_VEC3]=function(b){return function(c){a.uniform3iv(b,c)}},c[a.INT_VEC4]=function(b){return function(c){a.uniform4iv(b,c)}},c[a.FLOAT_VEC2]=function(b){return function(c){a.uniform2fv(b,c)}},c[a.FLOAT_VEC3]=function(b){return function(c){a.uniform2fv(b,c)}},c[a.FLOAT_VEC4]=function(b){return function(c){a.uniform2fv(b,c)}},c[a.FLOAT_MAT2]=function(b){return function(c){a.uniformMatrix2fv(b,!1,c)}},c[a.FLOAT_MAT3]=function(b){return function(c){a.uniformMatrix3fv(b,!1,c)}},c[a.FLOAT_MAT4]=function(b){return function(c){a.uniformMatrix4fv(b,!1,c)}},c[a.SAMPLER_2D]=function(b){return function(){a.uniform1i(b,a._state.textureUnit)}};var d={};d[a.FLOAT_VEC2]=function(b){return function(c){a.vertexAttribPointer(b,2,a.FLOAT,!1,a._state.bufferStride*4||0,c*4||0);return a.attrib}},d[a.FLOAT_VEC3]=function(b){return function(c){a.vertexAttribPointer(b,3,a.FLOAT,!1,a._state.bufferStride*4||0,c*4||0);return a.attrib}},d[a.FLOAT_VEC4]=function(b){return function(c){a.vertexAttribPointer(b,4,a.FLOAT,!1,a._state.bufferStride*4||0,c*4||0);return a.attrib}};var e=function(b,e,f){var g=a.getProgramParameter(b,a.ACTIVE_ATTRIBUTES);for(var h=0;h<g;++h){var i=a.getActiveAttrib(b,h),j=a.getAttribLocation(b,i.name);e[i.name]=d[i.type](j),e[i.name].val=j}var g=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var h=0;h<g;++h){var i=a.getActiveUniform(b,h),j=a.getUniformLocation(b,i.name);f[i.name]=c[i.type](j),f[i.name].val=j}},f=function(b,c,d){a.useProgram(b),a.uniform=d,a.attrib={};for(var e in c)a.attrib[e]=c[e],a.enableVertexAttribArray(c[e].val)},g=function(b,c,d){c.attached|=d;c.attached==3&&(a.linkProgram(c.val),a.getProgramParameter(c.val,a.LINK_STATUS)||console.log("gl.linkProgram("+b+"): "+a.getProgramInfoLog(c.val)),e(c.val,c.attrib,c.uniform),b==""&&f(c.val,c.attrib,c.uniform))};a.program=function(c){c===undefined&&(c="");var d=a._objects[c];d||(d=a._objects[c]={_attached:0,val:a.createProgram(),attrib:{},uniform:{},vert:function(e){a.attachShader(d.val,b(a.VERTEX_SHADER,e)),g(c,d,1);return d},frag:function(e){a.attachShader(d.val,b(a.FRAGMENT_SHADER,e)),g(c,d,2);return d},use:function(){f(d.val,d.attrib,d.uniform)}});return d}},glix.module.buffer=function(a){a.vertex=function(b){var c=a._objects[b];c||(c=a._objects[b]={val:a.createBuffer(),length:0,size:0,data:function(b,d,e){e===undefined&&(e=a.STATIC_DRAW),c.length=b.length/d,c.size=d,a.bufferData(a.ARRAY_BUFFER,new Float32Array(b),e);return c},bind:function(){a.bindBuffer(a.ARRAY_BUFFER,c.val);return c},assign:function(){a._state.bufferStride=c.size;return a.attrib}});return c.bind()},a.elements=function(b){var c=a._objects[b];c||(c=a._objects[b]={val:a.createBuffer(),length:0,data:function(b,d){d===undefined&&(d=a.STATIC_DRAW),c.length=b.length,a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),d);return c},bind:function(){a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,c.val);return c},draw:function(b,d,f){d=d*2||0,a.drawElements(b,f||c.length-d,a.UNSIGNED_SHORT,d*2)}});return c.bind()}},glix.module.texture=function(a){a.texture=function(b,c){var d=a._objects[b];d||(d=a._objects[b]={val:a.createTexture(),_image:null,_loaded:!1,width:0,height:0,_deferred:[],empty:function(b,c){d.width=b,d.height=c,d._loaded=!0,a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null);return d},store:function(){d._loaded=!0,d.bind(),d.width=d._image.width,d.height=d._image.height,a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,d._image);for(var b in d._deferred)d._deferred[b]();return d},wrap:function(b,c){if(!c._loaded){c._deferred.push(function(){c.wrap(b,c)});return c}a.texParamteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,b),a.texParamteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,c);return c},filter:function(b,c){if(!d._loaded){d._deferred.push(function(){d.filter(b,c)});return d}a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,c),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,b),(b==a.NEAREST_MIPMAP_NEAREST||b==a.LINEAR_MIPMAP_NEAREST||b==a.NEAREST_MIPMAP_LINEAR||b==a.LINEAR_MIPMAP_LINEAR)&&d.mipmap();return d},param:function(b,c){if(!d._loaded){d._deferred.push(function(){d.param(b,c)});return d}a.texParameteri(a.TEXTURE_2D,b,c);return d},image:function(a){d._image=new Image,d._image.onload=d.store,d._image.src=a;return d},bind:function(){a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,d.val);return d},assign:function(){a._state.textureUnit=c;return a.uniform},mipmap:function(){a.generateMipmap(a.TEXTURE_2D)}});return d.bind()}},glix.module.utils=function(a){var b=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)},c=window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;a.requestFrame=function(a){return b(a)},a.cancelRequestFrame=function(a){return c(a)}},function(){var a=window.Float32Array||Array,b=window.vec3={};b.create=function(b){var c=new a(3);b&&(c[0]=b[0],c[1]=b[1],c[2]=b[2]);return c},b.set=function(a,b){b[0]=a[0],b[1]=a[1],b[2]=a[2];return b},b.add=function(a,b,c){if(!c||a==c){a[0]+=b[0],a[1]+=b[1],a[2]+=b[2];return a}c[0]=a[0]+b[0],c[1]=a[1]+b[1],c[2]=a[2]+b[2];return c},b.subtract=function(a,b,c){if(!c||a==c){a[0]-=b[0],a[1]-=b[1],a[2]-=b[2];return a}c[0]=a[0]-b[0],c[1]=a[1]-b[1],c[2]=a[2]-b[2];return c},b.negate=function(a,b){b||(b=a),b[0]=-a[0],b[1]=-a[1],b[2]=-a[2];return b},b.scale=function(a,b,c){if(!c||a==c){a[0]*=b,a[1]*=b,a[2]*=b;return a}c[0]=a[0]*b,c[1]=a[1]*b,c[2]=a[2]*b;return c},b.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=Math.sqrt(c*c+d*d+e*e);if(!f){b[0]=0,b[1]=0,b[2]=0;return b}if(f==1){b[0]=c,b[1]=d,b[2]=e;return b}f=1/f,b[0]=c*f,b[1]=d*f,b[2]=e*f;return b},b.cross=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=b[0],h=b[1],i=b[2];c[0]=e*i-f*h,c[1]=f*g-d*i,c[2]=d*h-e*g;return c},b.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},b.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},b.direction=function(a,b,c){c||(c=a);var d=a[0]-b[0],e=a[1]-b[1],f=a[2]-b[2],g=Math.sqrt(d*d+e*e+f*f);if(!g){c[0]=0,c[1]=0,c[2]=0;return c}g=1/g,c[0]=d*g,c[1]=e*g,c[2]=f*g;return c},b.lerp=function(a,b,c,d){d||(d=a),d[0]=a[0]+c*(b[0]-a[0]),d[1]=a[1]+c*(b[1]-a[1]),d[2]=a[2]+c*(b[2]-a[2]);return d},b.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};var c=window.mat4={};c.create=function(b){var c=new a(16);b&&(c[0]=b[0],c[1]=b[1],c[2]=b[2],c[3]=b[3],c[4]=b[4],c[5]=b[5],c[6]=b[6],c[7]=b[7],c[8]=b[8],c[9]=b[9],c[10]=b[10],c[11]=b[11],c[12]=b[12],c[13]=b[13],c[14]=b[14],c[15]=b[15]);return c},c.set=function(a,b){b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15];return b},c.identity=function(a){a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1;return a},c.transpose=function(a,b){if(!b||a==b){var c=a[1],d=a[2],e=a[3],f=a[6],g=a[7],h=a[11];a[1]=a[4],a[2]=a[8],a[3]=a[12],a[4]=c,a[6]=a[9],a[7]=a[13],a[8]=d,a[9]=f,a[11]=a[14],a[12]=e,a[13]=g,a[14]=h;return a}b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b},c.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15];return n*k*h*e-j*o*h*e-n*g*l*e+f*o*l*e+j*g*p*e-f*k*p*e-n*k*d*i+j*o*d*i+n*c*l*i-b*o*l*i-j*c*p*i+b*k*p*i+n*g*d*m-f*o*d*m-n*c*h*m+b*o*h*m+f*c*p*m-b*g*p*m-j*g*d*q+f*k*d*q+j*c*h*q-b*k*h*q-f*c*l*q+b*g*l*q},c.inverse=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=a[9],m=a[10],n=a[11],o=a[12],p=a[13],q=a[14],r=a[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=1/(s*D-t*C+u*B+v*A-w*z+x*y);b[0]=(h*D-i*C+j*B)*E,b[1]=(-d*D+e*C-f*B)*E,b[2]=(p*x-q*w+r*v)*E,b[3]=(-l*x+m*w-n*v)*E,b[4]=(-g*D+i*A-j*z)*E,b[5]=(c*D-e*A+f*z)*E,b[6]=(-o*x+q*u-r*t)*E,b[7]=(k*x-m*u+n*t)*E,b[8]=(g*C-h*A+j*y)*E,b[9]=(-c*C+d*A-f*y)*E,b[10]=(o*w-p*u+r*s)*E,b[11]=(-k*w+l*u-n*s)*E,b[12]=(-g*B+h*z-i*y)*E,b[13]=(c*B-d*z+e*y)*E,b[14]=(-o*v+p*t-q*s)*E,b[15]=(k*v-l*t+m*s)*E;return b},c.toRotationMat=function(a,b){b||(b=c.create()),b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=0,b[13]=0,b[14]=0,b[15]=1;return b},c.toMat3=function(a,b){b||(b=mat3.create()),b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[4],b[4]=a[5],b[5]=a[6],b[6]=a[8],b[7]=a[9],b[8]=a[10];return b},c.toInverseMat3=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[4],g=a[5],h=a[6],i=a[8],j=a[9],k=a[10],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;if(!o)return null;var p=1/o;b||(b=mat3.create()),b[0]=l*p,b[1]=(-k*d+e*j)*p,b[2]=(h*d-e*g)*p,b[3]=m*p,b[4]=(k*c-e*i)*p,b[5]=(-h*c+e*f)*p,b[6]=n*p,b[7]=(-j*c+d*i)*p,b[8]=(g*c-d*f)*p;return b},c.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[5],j=a[6],k=a[7],l=a[8],m=a[9],n=a[10],o=a[11],p=a[12],q=a[13],r=a[14],s=a[15],t=b[0],u=b[1],v=b[2],w=b[3],x=b[4],y=b[5],z=b[6],A=b[7],B=b[8],C=b[9],D=b[10],E=b[11],F=b[12],G=b[13],H=b[14],I=b[15];c[0]=t*d+u*h+v*l+w*p,c[1]=t*e+u*i+v*m+w*q,c[2]=t*f+u*j+v*n+w*r,c[3]=t*g+u*k+v*o+w*s,c[4]=x*d+y*h+z*l+A*p,c[5]=x*e+y*i+z*m+A*q,c[6]=x*f+y*j+z*n+A*r,c[7]=x*g+y*k+z*o+A*s,c[8]=B*d+C*h+D*l+E*p,c[9]=B*e+C*i+D*m+E*q,c[10]=B*f+C*j+D*n+E*r,c[11]=B*g+C*k+D*o+E*s,c[12]=F*d+G*h+H*l+I*p,c[13]=F*e+G*i+H*m+I*q,c[14]=F*f+G*j+H*n+I*r,c[15]=F*g+G*k+H*o+I*s;return c},c.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2];c[0]=a[0]*d+a[4]*e+a[8]*f+a[12],c[1]=a[1]*d+a[5]*e+a[9]*f+a[13],c[2]=a[2]*d+a[6]*e+a[10]*f+a[14];return c},c.multiplyVec4=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],g=b[3];c[0]=a[0]*d+a[4]*e+a[8]*f+a[12]*g,c[1]=a[1]*d+a[5]*e+a[9]*f+a[13]*g,c[2]=a[2]*d+a[6]*e+a[10]*f+a[14]*g,c[3]=a[3]*d+a[7]*e+a[11]*f+a[15]*g;return c},c.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2];if(!c||a==c){a[12]=a[0]*d+a[4]*e+a[8]*f+a[12],a[13]=a[1]*d+a[5]*e+a[9]*f+a[13],a[14]=a[2]*d+a[6]*e+a[10]*f+a[14],a[15]=a[3]*d+a[7]*e+a[11]*f+a[15];return a}var g=a[0],h=a[1],i=a[2],j=a[3],k=a[4],l=a[5],m=a[6],n=a[7],o=a[8],p=a[9],q=a[10],r=a[11];c[0]=g,c[1]=h,c[2]=i,c[3]=j,c[4]=k,c[5]=l,c[6]=m,c[7]=n,c[8]=o,c[9]=p,c[10]=q,c[11]=r,c[12]=g*d+k*e+o*f+a[12],c[13]=h*d+l*e+p*f+a[13],c[14]=i*d+m*e+q*f+a[14],c[15]=j*d+n*e+r*f+a[15];return c},c.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2];if(!c||a==c){a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=d,a[4]*=e,a[5]*=e,a[6]*=e,a[7]*=e,a[8]*=f,a[9]*=f,a[10]*=f,a[11]*=f;return a}c[0]=a[0]*d,c[1]=a[1]*d,c[2]=a[2]*d,c[3]=a[3]*d,c[4]=a[4]*e,c[5]=a[5]*e,c[6]=a[6]*e,c[7]=a[7]*e,c[8]=a[8]*f,c[9]=a[9]*f,c[10]=a[10]*f,c[11]=a[11]*f,c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15];return c},c.rotate=function(a,b,c,d){var e=c[0],f=c[1],g=c[2],h=Math.sqrt(e*e+f*f+g*g);if(!h)return null;h!=1&&(h=1/h,e*=h,f*=h,g*=h);var i=Math.sin(b),j=Math.cos(b),k=1-j,l=a[0],m=a[1],n=a[2],o=a[3],p=a[4],q=a[5],r=a[6],s=a[7],t=a[8],u=a[9],v=a[10],w=a[11],x=e*e*k+j,y=f*e*k+g*i,z=g*e*k-f*i,A=e*f*k-g*i,B=f*f*k+j,C=g*f*k+e*i,D=e*g*k+f*i,E=f*g*k-e*i,F=g*g*k+j;d?a!=d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a,d[0]=l*x+p*y+t*z,d[1]=m*x+q*y+u*z,d[2]=n*x+r*y+v*z,d[3]=o*x+s*y+w*z,d[4]=l*A+p*B+t*C,d[5]=m*A+q*B+u*C,d[6]=n*A+r*B+v*C,d[7]=o*A+s*B+w*C,d[8]=l*D+p*E+t*F,d[9]=m*D+q*E+u*F,d[10]=n*D+r*E+v*F,d[11]=o*D+s*E+w*F;return d},c.rotateX=function(a,b,c){var d=Math.sin(b),e=Math.cos(b),f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11];c?a!=c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a,c[4]=f*e+j*d,c[5]=g*e+k*d,c[6]=h*e+l*d,c[7]=i*e+m*d,c[8]=f*-d+j*e,c[9]=g*-d+k*e,c[10]=h*-d+l*e,c[11]=i*-d+m*e;return c},c.rotateY=function(a,b,c){var d=Math.sin(b),e=Math.cos(b),f=a[0],g=a[1],h=a[2],i=a[3],j=a[8],k=a[9],l=a[10],m=a[11];c?a!=c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a,c[0]=f*e+j*-d,c[1]=g*e+k*-d,c[2]=h*e+l*-d,c[3]=i*e+m*-d,c[8]=f*d+j*e,c[9]=g*d+k*e,c[10]=h*d+l*e,c[11]=i*d+m*e;return c},c.rotateZ=function(a,b,c){var d=Math.sin(b),e=Math.cos(b),f=a[0],g=a[1],h=a[2],i=a[3],j=a[4],k=a[5],l=a[6],m=a[7];c?a!=c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a,c[0]=f*e+j*d,c[1]=g*e+k*d,c[2]=h*e+l*d,c[3]=i*e+m*d,c[4]=f*-d+j*e,c[5]=g*-d+k*e,c[6]=h*-d+l*e,c[7]=i*-d+m*e;return c},c.frustum=function(a,b,d,e,f,g,h){h||(h=c.create());var i=b-a,j=e-d,k=g-f;h[0]=f*2/i,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=f*2/j,h[6]=0,h[7]=0,h[8]=(b+a)/i,h[9]=(e+d)/j,h[10]=-(g+f)/k,h[11]=-1,h[12]=0,h[13]=0,h[14]=-(g*f*2)/k,h[15]=0;return h},c.perspective=function(a,b,d,e,f){var g=d*Math.tan(a*Math.PI/360),h=g*b;return c.frustum(-h,h,-g,g,d,e,f)},c.ortho=function(a,b,d,e,f,g,h){h||(h=c.create());var i=b-a,j=e-d,k=g-f;h[0]=2/i,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=2/j,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=-2/k,h[11]=0,h[12]=-(a+b)/i,h[13]=-(e+d)/j,h[14]=-(g+f)/k,h[15]=1;return h},c.lookAt=function(a,b,d,e){e||(e=c.create());var f=a[0],g=a[1],h=a[2],i=d[0],j=d[1],k=d[2],l=b[0],m=b[1],n=b[2];if(f==l&&g==m&&h==n)return c.identity(e);var o,p,q,r,s,t,u,v,w,x;o=f-b[0],p=g-b[1],q=h-b[2],x=1/Math.sqrt(o*o+p*p+q*q),o*=x,p*=x,q*=x,r=j*q-k*p,s=k*o-i*q,t=i*p-j*o,x=Math.sqrt(r*r+s*s+t*t),x?(x=1/x,r*=x,s*=x,t*=x):(r=0,s=0,t=0),u=p*t-q*s,v=q*r-o*t,w=o*s-p*r,x=Math.sqrt(u*u+v*v+w*w),x?(x=1/x,u*=x,v*=x,w*=x):(u=0,v=0,w=0),e[0]=r,e[1]=u,e[2]=o,e[3]=0,e[4]=s,e[5]=v,e[6]=p,e[7]=0,e[8]=t,e[9]=w,e[10]=q,e[11]=0,e[12]=-(r*f+s*g+t*h),e[13]=-(u*f+v*g+w*h),e[14]=-(o*f+p*g+q*h),e[15]=1;return e},c.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"};var d=window.quat4={};d.create=function(b){var c=new a(4);b&&(c[0]=b[0],c[1]=b[1],c[2]=b[2],c[3]=b[3]);return c},d.set=function(a,b){b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3];return b},d.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];if(!b||a==b){a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return a}b[0]=c,b[1]=d,b[2]=e,b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b},d.inverse=function(a,b){if(!b||a==b){a[0]*=-1,a[1]*=-1,a[2]*=-1;return a}b[0]=-a[0],b[1]=-a[1],b[2]=-a[2],b[3]=a[3];return b},d.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},d.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],f=a[3],g=Math.sqrt(c*c+d*d+e*e+f*f);if(g==0){b[0]=0,b[1]=0,b[2]=0,b[3]=0;return b}g=1/g,b[0]=c*g,b[1]=d*g,b[2]=e*g,b[3]=f*g;return b},d.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],f=a[2],g=a[3],h=b[0],i=b[1],j=b[2],k=b[3];c[0]=d*k+g*h+e*j-f*i,c[1]=e*k+g*i+f*h-d*j,c[2]=f*k+g*j+d*i-e*h,c[3]=g*k-d*h-e*i-f*j;return c},d.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],f=b[2],g=a[0],h=a[1],i=a[2],j=a[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;c[0]=k*j+n*-g+l*-i-m*-h,c[1]=l*j+n*-h+m*-g-k*-i,c[2]=m*j+n*-i+k*-h-l*-g;return c},d.toMat3=function(a,b){b||(b=mat3.create());var c=a[0],d=a[1],e=a[2],f=a[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;b[0]=1-(m+o),b[1]=k-r,b[2]=l+q,b[3]=k+r,b[4]=1-(j+o),b[5]=n-p,b[6]=l-q,b[7]=n+p,b[8]=1-(j+m);return b},d.toMat4=function(a,b){b||(b=c.create());var d=a[0],e=a[1],f=a[2],g=a[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;b[0]=1-(n+p),b[1]=l-s,b[2]=m+r,b[3]=0,b[4]=l+s,b[5]=1-(k+p),b[6]=o-q,b[7]=0,b[8]=m-r,b[9]=o+q,b[10]=1-(k+n),b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1;return b},d.slerp=function(a,b,c,d){d||(d=a);var e=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3];if(Math.abs(e)>=1){d!=a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3]);return d}var f=Math.acos(e),g=Math.sqrt(1-e*e);if(Math.abs(g)<.001){d[0]=a[0]*.5+b[0]*.5,d[1]=a[1]*.5+b[1]*.5,d[2]=a[2]*.5+b[2]*.5,d[3]=a[3]*.5+b[3]*.5;return d}var h=Math.sin((1-c)*f)/g,i=Math.sin(c*f)/g;d[0]=a[0]*h+b[0]*i,d[1]=a[1]*h+b[1]*i,d[2]=a[2]*h+b[2]*i,d[3]=a[3]*h+b[3]*i;return d},d.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}}()