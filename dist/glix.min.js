(function(){var a=function(b){var c=document.getElementById(b),d=c.getContext("experimental-webgl");d.canvas=c;for(var e in a.module)a.module[e](d);return d};a.module={base:function(a){a._state={},a._objects={}}},"glix"in window||(window.glix=a)})(),glix.module.objects=function(a){a.assign=function(b){var c=a._objects[b];if(!c)throw"'"+b+"' used before being initialized.";c.bind();return c.assign()}},glix.module.shader=function(a){var b={},c=function(b,c){var d;if(c[0]=="#"){var e=document.getElementById(c.slice(1));d=e.textContent}else{var e=$.ajax({url:c,async:!1});d=e.responseText}var f=a.createShader(b);a.shaderSource(f,d),a.compileShader(f);if(!a.getShaderParameter(f,a.COMPILE_STATUS))throw"gl.compileShader("+c+"): "+a.getShaderInfoLog(f);return f},d={};d[a.INT]=function(b){return function(c){a.uniform1i(b,c)}},d[a.FLOAT]=function(b){return function(c){a.uniform1f(b,c)}},d[a.INT_VEC2]=function(b){return function(c){a.uniform2iv(b,c)}},d[a.INT_VEC3]=function(b){return function(c){a.uniform3iv(b,c)}},d[a.INT_VEC4]=function(b){return function(c){a.uniform4iv(b,c)}},d[a.FLOAT_VEC2]=function(b){return function(c){a.uniform2fv(b,c)}},d[a.FLOAT_VEC3]=function(b){return function(c){a.uniform2fv(b,c)}},d[a.FLOAT_VEC4]=function(b){return function(c){a.uniform2fv(b,c)}},d[a.FLOAT_MAT2]=function(b){return function(c){a.uniformMatrix2fv(b,!1,c)}},d[a.FLOAT_MAT3]=function(b){return function(c){a.uniformMatrix3fv(b,!1,c)}},d[a.FLOAT_MAT4]=function(b){return function(c){a.uniformMatrix4fv(b,!1,c)}},d[a.SAMPLER_2D]=function(b){return function(){a.uniform1i(b,a._state.textureUnit)}};var e={};e[a.FLOAT_VEC2]=function(b){return function(c){a.vertexAttribPointer(b,2,a.FLOAT,!1,a._state.bufferStride*4||0,c*4||0);return a.attrib}},e[a.FLOAT_VEC3]=function(b){return function(c){a.vertexAttribPointer(b,3,a.FLOAT,!1,a._state.bufferStride*4||0,c*4||0);return a.attrib}},e[a.FLOAT_VEC4]=function(b){return function(c){a.vertexAttribPointer(b,4,a.FLOAT,!1,a._state.bufferStride*4||0,c*4||0);return a.attrib}};var f=function(b,c,f){var g=a.getProgramParameter(b,a.ACTIVE_ATTRIBUTES);for(var h=0;h<g;++h){var i=a.getActiveAttrib(b,h),j=a.getAttribLocation(b,i.name);c[i.name]=e[i.type](j),c[i.name].val=j}var g=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var h=0;h<g;++h){var i=a.getActiveUniform(b,h),j=a.getUniformLocation(b,i.name);f[i.name]=d[i.type](j),f[i.name].val=j}},g=function(b,c,d){a.useProgram(b),a.uniform=d,a.attrib={};for(var e in c)a.attrib[e]=c[e],a.enableVertexAttribArray(c[e].val)},h=function(b,c,d){c.attached|=d;c.attached==3&&(a.linkProgram(c.val),a.getProgramParameter(c.val,a.LINK_STATUS)||console.log("gl.linkProgram("+b+"): "+a.getProgramInfoLog(c.val)),f(c.val,c.attrib,c.uniform),b==""&&g(c.val,c.attrib,c.uniform))};a.program=function(d){d===undefined&&(d="");var e=b[d];e||(e=b[d]={_attached:0,val:a.createProgram(),attrib:{},uniform:{},vert:function(b){a.attachShader(e.val,c(a.VERTEX_SHADER,b)),h(d,e,1);return e},frag:function(b){a.attachShader(e.val,c(a.FRAGMENT_SHADER,b)),h(d,e,2);return e},use:function(){g(e.val,e.attrib,e.uniform)}});return e}},glix.module.buffer=function(a){a.vertex=function(b){var c=a._objects[b];c||(c=a._objects[b]={val:a.createBuffer(),length:0,size:0,data:function(b,d,e){e===undefined&&(e=a.STATIC_DRAW),c.length=b.length/d,c.size=d,a.bufferData(a.ARRAY_BUFFER,new Float32Array(b),e);return c},bind:function(){a.bindBuffer(a.ARRAY_BUFFER,c.val);return c},assign:function(){a._state.bufferStride=c.size;return a.attrib}});return c.bind()},a.elements=function(b){var c=a._objects[b];c||(c=a._objects[b]={val:a.createBuffer(),length:0,data:function(b,d){d===undefined&&(d=a.STATIC_DRAW),c.length=b.length,a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),d);return c},bind:function(){a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,c.val);return c},draw:function(b,d,f){d=d*2||0,a.drawElements(b,f||c.length-d,a.UNSIGNED_SHORT,d*2)}});return c.bind()}},glix.module.texture=function(a){a.texture=function(b,c){c=c||b;var d=a._objects[c];d||(d=a._objects[c]={val:a.createTexture(),_image:null,_loaded:!1,_deferred:[],store:function(){d._loaded=!0,d.bind(),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,d._image);for(var b in d._deferred)d._deferred[b]();return d},wrap:function(b,c){if(!c._loaded){c._deferred.push(function(){c.wrap(b,c)});return c}a.texParamteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,b),a.texParamteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,c);return c},filter:function(b,c){if(!d._loaded){d._deferred.push(function(){d.filter(b,c)});return d}a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,c),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,b),(b==a.NEAREST_MIPMAP_NEAREST||b==a.LINEAR_MIPMAP_NEAREST||b==a.NEAREST_MIPMAP_LINEAR||b==a.LINEAR_MIPMAP_LINEAR)&&a.generateMipmap(a.TEXTURE_2D);return d},param:function(b,c){if(!d._loaded){d._deferred.push(function(){d.param(b,c)});return d}a.texParameteri(a.TEXTURE_2D,b,c);return d},image:function(a){d._image=new Image,d._image.onload=d.store,d._image.src=a;return d},bind:function(){a.activeTexture(a.TEXTURE0+b),a.bindTexture(a.TEXTURE_2D,d.val);return d},assign:function(){a._state.textureUnit=b;return a.uniform}});return d.bind()}},glix.module.utils=function(a){var b=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)},c=window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;a.requestFrame=function(a){return b(a)},a.cancelRequestFrame=function(a){return c(a)}}